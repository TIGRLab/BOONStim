executor = 'local'
params.bin = "${bin}"
params.coil = "${coil}"
params.simg = "${simg}"
params.ciftify_img = "${ciftify_img}"
params.ciftify_invocation = "${ciftify_invocation}"
params.ciftify_descriptor = "${ciftify_descriptor}"
params.fmriprep_img = "${fmriprep_img}"
params.anat_invocation = "${anat_invocation}"
params.anat_descriptor = "${anat_descriptor}"
params.license = "${license}"
params.freesurfer = "${freesurfer}"
params.connectome = "${connectome}"
params.atlas = "${atlas}"
params.msm = "${msm}"
params.weightworkflow = "${weightworkflow}"
params.work = "/tmp/"
params.cpus = num_cpus
process {

    withName: fmriprep_anat {
        errorStrategy = {task.attempt == 3 ? "finish" : "retry"}
        scratch = "${params.work}"
    }

    withName: ciftify{
        errorStrategy = {task.attempt == 3 ? "finish" : "retry"}
        scratch = "${params.work}"
    }

    withName: mri2mesh{
        errorStrategy = {task.attempt == 3 ? "finish" : "retry"}
        containerOptions = "-B ${params.license}:/license"
        container = "${simnibs3_img}"
        scratch = "${params.work}"
    }

    withName: mri2mesh_brain{
        container = "${simnibs3_img}"
        errorStrategy = {task.attempt == 3 ? "finish" : "retry"}
        containerOptions = "-B ${params.license}:/license"
        scratch = "${params.work}"
    }

    withLabel: connectome{
        errorStrategy = {task.attempt == 3 ? "finish" : "retry"}
        container = "${connectome_img}"
    }

    withName: optimize_coil{
        errorStrategy = {task.attempt == 3 ? "finish" : "retry"}
        scratch = "${params.work}"
    }

    withLabel: freesurfer{ container = "${freesurfer_img}" }
    withLabel: rtms{ container ="${rtms_img}" }
    withLabel: gmsh4{ container ="${rtms_img}" }
    withLabel: ciftify { container = "${ciftify_img}" }
}
